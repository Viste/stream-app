{% extends 'layout.html' %}

{% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<style>
    .video-container {
        margin-bottom: 20px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 15px;
        border-radius: 5px;
    }
    .course-container {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
    }
    .course-link {
        color: #007bff;
        text-decoration: none;
    }
    .course-link:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2>Онлайн Трансляции</h2>
    {% for broadcast in live_broadcasts %}
    <div class="video-container">
        <h3>{{ broadcast.course.name }}</h3>
        <video id="video_{{ loop.index }}" controls style="width: 100%; height: auto;"></video>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var video = document.getElementById('video_{{ loop.index }}');
                var videoSrc = 'https://live.pprfnk.tech/hls/{{ broadcast.course.short_name }}/index.m3u8';
                if (Hls.isSupported()) {
                    var hls = new Hls();
                    hls.loadSource(videoSrc);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        video.play();
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = videoSrc;
                    video.addEventListener('loadedmetadata', function() {
                        video.play();
                    });
                }
            });
        </script>
    </div>
    {% endfor %}

    <h2>Доступные Курсы</h2>
    {% for course in courses %}
    <div class="course-container">
        <h3><a class="course-link" href="{{ url_for('course_page', short_name=course.short_name) }}">{{ course.name }}</a></h3>
        <p>{{ course.description }}</p>
    </div>
    {% endfor %}
</div>
{% endblock %}
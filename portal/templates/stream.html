{% extends 'layout.html' %}

{% block content %}
<div class="container">
    <h2>Онлайн Трансляции</h2>
    {% for broadcast in live_broadcasts %}
    <div>
        <h3>{{ broadcast.course.name }}</h3>
        <video id="video_{{ loop.index }}" controls></video>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var video = document.getElementById('video_{{ loop.index }}');
                var videoSrc = 'https://live.pprfnk.tech/hls/{{ broadcast.course.short_name }}/index.m3u8';
                if (Hls.isSupported()) {
                    var hls = new Hls();
                    hls.loadSource(videoSrc);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        video.play();
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = videoSrc;
                    video.addEventListener('loadedmetadata', function() {
                        video.play();
                    });
                }
            });
        </script>
    </div>
    {% endfor %}

    <h2>Доступные Курсы</h2>
    {% for course in courses %}
    <div>
        <h3><a href="{{ url_for('course_page', short_name=course.short_name) }}">{{ course.name }}</a></h3>
        <p>{{ course.description }}</p>
    </div>
    {% endfor %}
</div>
{% endblock %}